{% extends "base.html" %}

{% block title %}{{ poster.get_full_name() or poster.username }} - Poster Profile{% endblock %}

{% block content %}
<div class="profile-background 
     {% if user_profile and user_profile.background_style %}profile-bg-{{ user_profile.background_style }}{% else %}profile-bg-default{% endif %}
     {% if user_profile and user_profile.background_overlay %}with-overlay{% endif %}">
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <!-- Poster Profile Card -->
            <div class="card glass-card mb-4">
                {% set user_profile = poster.profile %}
                <div class="card-header glass-header" 
                     {% if user_profile and user_profile.banner_style %}
                     style="background: {{ user_profile.banner_style }}; backdrop-filter: blur(20px);"
                     {% endif %}>
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h4 class="mb-0">
                                <i class="fas fa-user-circle me-2"></i>
                                {{ poster.get_full_name() or poster.username }}
                                {% if user_profile and user_profile.custom_title %}
                                    <span class="custom-title ms-2" style="color: {{ user_profile.title_color }};">
                                        {{ user_profile.custom_title }}
                                    </span>
                                {% endif %}
                            </h4>
                            <p class="mb-0 text-muted">
                                <i class="fas fa-envelope me-1"></i>{{ poster.email }}
                            </p>
                            {% set rank_info = poster.get_rank_info() %}
                            <div class="mt-2">
                                <span class="badge glass-badge">
                                    <i class="fas {{ rank_info.current_rank.icon }}" style="color: {{ rank_info.current_rank.color }}"></i>
                                    {{ rank_info.current_rank.name }} ({{ rank_info.total_points }} pts)
                                </span>
                            </div>
                        </div>
                        <div class="col-md-4 text-md-end">
                            {% if current_user.is_authenticated and current_user.id != poster.id %}
                            <a href="{{ url_for('private_chat', recipient_id=poster.id) }}" class="btn btn-primary glass-button">
                                <i class="fas fa-comment me-2"></i>Private Chat
                            </a>
                            {% elif current_user.is_authenticated and current_user.id == poster.id %}
                            <button type="button" class="btn btn-secondary glass-button" data-bs-toggle="modal" data-bs-target="#customizeProfileModal">
                                <i class="fas fa-palette me-2"></i>Customize Profile
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="profile-stats">
                                <div class="stat-item">
                                    <h5 class="stat-number">{{ posted_books|length }}</h5>
                                    <p class="stat-label">Books Posted</p>
                                </div>
                                <div class="stat-item">
                                    <h5 class="stat-number">{{ poster.created_at.strftime('%B %Y') }}</h5>
                                    <p class="stat-label">Member Since</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="profile-info">
                                <h6><i class="fas fa-info-circle me-2"></i>About</h6>
                                <p class="text-muted">
                                    Active community member sharing knowledge through book lending.
                                    {% if poster.get_full_name() %}
                                    Known as {{ poster.get_full_name() }} in the community.
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Posted Books Section -->
            <div class="card glass-card">
                <div class="card-header glass-header">
                    <h5 class="mb-0">
                        <i class="fas fa-books me-2"></i>
                        Books Posted by {{ poster.get_full_name() or poster.username }}
                    </h5>
                </div>
                
                <div class="card-body">
                    {% if posted_books %}
                        <div class="row">
                            {% for book in posted_books %}
                            <div class="col-md-6 col-lg-4 mb-4">
                                <div class="card book-card h-100">
                                    <div class="book-cover-container">
                                        <img src="{{ book.cover_url or 'https://via.placeholder.com/300x400?text=No+Cover' }}" 
                                             class="card-img-top book-cover" 
                                             alt="{{ book.title }}"
                                             onerror="this.src='https://via.placeholder.com/300x400?text=No+Cover'">
                                    </div>
                                    <div class="card-body d-flex flex-column">
                                        <h6 class="card-title">{{ book.title }}</h6>
                                        <p class="card-text text-muted small">
                                            <i class="fas fa-user me-1"></i>{{ book.author }}
                                        </p>
                                        <p class="card-text text-muted small">
                                            <i class="fas fa-tag me-1"></i>{{ book.category }}
                                        </p>
                                        {% if book.description and ('Price:' in book.description or 'Contact:' in book.description) %}
                                        <div class="book-contact-info">
                                            {% for line in book.description.split('\n') %}
                                                {% if 'Price:' in line or 'Contact:' in line %}
                                                    <small class="text-info">{{ line }}</small><br>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                        <div class="mt-auto">
                                            <a href="{{ url_for('book_detail', book_id=book.id) }}" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-eye me-1"></i>View Details
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="empty-books text-center py-5">
                            <i class="fas fa-book-open fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No books posted yet</h5>
                            <p class="text-muted">{{ poster.get_full_name() or poster.username }} hasn't posted any books to the library yet.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Back Button -->
            <div class="text-center mt-4">
                <a href="{{ url_for('index') }}" class="btn btn-outline-secondary glass-button">
                    <i class="fas fa-arrow-left me-2"></i>Back to Catalog
                </a>
            </div>
        </div>
    </div>
</div>

<style>
/* Poster Profile Styles */
.glass-header {
    background: rgba(255, 255, 255, 0.1);
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(20px);
    border-radius: 15px 15px 0 0;
}

.profile-stats {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.stat-item {
    text-align: center;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    padding: 15px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.stat-number {
    font-size: 1.8rem;
    font-weight: bold;
    color: #fff;
    margin-bottom: 5px;
}

.stat-label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
    margin-bottom: 0;
}

.profile-info {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    padding: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    height: 100%;
}

.book-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    transition: all 0.3s ease;
    overflow: hidden;
}

.book-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    background: rgba(255, 255, 255, 0.1);
}

.book-cover-container {
    height: 200px;
    overflow: hidden;
    position: relative;
}

.book-cover {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.book-card:hover .book-cover {
    transform: scale(1.05);
}

.book-contact-info {
    background: rgba(74, 144, 226, 0.1);
    border: 1px solid rgba(74, 144, 226, 0.3);
    border-radius: 8px;
    padding: 8px;
    margin-bottom: 10px;
}

.empty-books {
    height: 300px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .profile-stats {
        flex-direction: row;
        justify-content: space-around;
        margin-bottom: 20px;
    }
    
    .stat-item {
        flex: 1;
        margin: 0 5px;
    }
    
    .stat-number {
        font-size: 1.4rem;
    }
}

/* Profile Customization Modal Styles */
.banner-option {
    cursor: pointer;
    border: 2px solid transparent;
    border-radius: 10px;
    padding: 5px;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.05);
}

.banner-option:hover {
    border-color: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
}

.banner-option.selected {
    border-color: #4a90e2;
    background: rgba(74, 144, 226, 0.1);
}

.banner-preview {
    height: 60px;
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    margin-bottom: 10px;
    backdrop-filter: blur(10px);
}

.banner-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.9rem;
}

.banner-name {
    font-weight: bold;
}

.banner-cost {
    color: #ffd700;
    font-weight: bold;
}

.color-options {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.color-option {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.color-option:hover {
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.color-option.selected {
    border-color: #4a90e2;
    transform: scale(1.2);
}

.custom-title {
    font-size: 0.9rem;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.glass-alert {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    backdrop-filter: blur(10px);
}

.glass-input {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: white;
    backdrop-filter: blur(10px);
}

.glass-input:focus {
    background: rgba(255, 255, 255, 0.15);
    border-color: #4a90e2;
    color: white;
    box-shadow: 0 0 0 0.2rem rgba(74, 144, 226, 0.25);
}

.glass-input::placeholder {
    color: rgba(255, 255, 255, 0.7);
}

/* Profile Background Themes */
.profile-background {
    min-height: 100vh;
    position: relative;
    padding: 0;
}

.profile-bg-default {
    background: #0d1117;
}

.profile-bg-space {
    background: linear-gradient(135deg, #000428 0%, #004e92 100%),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="1" fill="white" opacity="0.8"/><circle cx="80" cy="30" r="0.5" fill="white" opacity="0.6"/><circle cx="40" cy="70" r="0.8" fill="white" opacity="0.9"/><circle cx="90" cy="80" r="0.3" fill="white" opacity="0.5"/><circle cx="10" cy="90" r="0.6" fill="white" opacity="0.7"/></svg>');
    background-attachment: fixed;
    background-size: 100% 100%, 20px 20px;
}

.profile-bg-ocean {
    background: linear-gradient(135deg, #667db6 0%, #0082c8 25%, #0052cc 50%, #667db6 100%);
    background-size: 400% 400%;
    animation: ocean-wave 8s ease-in-out infinite;
    background-attachment: fixed;
}

@keyframes ocean-wave {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

.profile-bg-forest {
    background: linear-gradient(135deg, #134e5e 0%, #71b280 100%),
                radial-gradient(circle at 30% 60%, rgba(0, 100, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 70% 30%, rgba(34, 139, 34, 0.4) 0%, transparent 50%);
    background-attachment: fixed;
}

.profile-bg-neon {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #533483 100%);
    position: relative;
    background-attachment: fixed;
}

.profile-bg-neon::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        linear-gradient(90deg, transparent 0%, rgba(255, 0, 255, 0.1) 25%, transparent 50%, rgba(0, 255, 255, 0.1) 75%, transparent 100%);
    animation: neon-glow 3s ease-in-out infinite alternate;
    pointer-events: none;
    z-index: -1;
}

@keyframes neon-glow {
    0% { opacity: 0.5; }
    100% { opacity: 1; }
}

.profile-bg-aurora {
    background: linear-gradient(135deg, #000428 0%, #004e92 25%, #009ffd 50%, #00d2ff 100%);
    background-size: 300% 300%;
    animation: aurora-dance 10s ease-in-out infinite;
    background-attachment: fixed;
}

@keyframes aurora-dance {
    0%, 100% { background-position: 0% 50%; }
    25% { background-position: 100% 0%; }
    50% { background-position: 100% 100%; }
    75% { background-position: 0% 100%; }
}

.with-overlay::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.4);
    pointer-events: none;
    z-index: -1;
}

.profile-background .container {
    position: relative;
    z-index: 1;
}
</style>

<!-- Profile Customization Modal -->
{% if current_user.is_authenticated and current_user.id == poster.id %}
<div class="modal fade" id="customizeProfileModal" tabindex="-1" aria-labelledby="customizeProfileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content glass-card">
            <div class="modal-header glass-header">
                <h5 class="modal-title" id="customizeProfileModalLabel">
                    <i class="fas fa-palette me-2"></i>Customize Your Profile
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info glass-alert">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Your Points:</strong> <span id="currentPoints">{{ rank_info.total_points }}</span>
                </div>

                <!-- Preview Section -->
                <div class="mb-4">
                    <h6><i class="fas fa-eye me-2"></i>Preview</h6>
                    <div class="card glass-card">
                        <div class="card-header glass-header" id="previewHeader">
                            <h4 class="mb-0">
                                <i class="fas fa-user-circle me-2"></i>
                                {{ poster.get_full_name() or poster.username }}
                                <span class="custom-title ms-2" id="previewTitle" style="color: #ffffff;"></span>
                            </h4>
                        </div>
                    </div>
                </div>

                <!-- Banner Selection -->
                <div class="mb-4">
                    <h6><i class="fas fa-image me-2"></i>Profile Banner</h6>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="banner-option" data-style="" data-cost="0">
                                <div class="banner-preview glass-header">Default</div>
                                <div class="banner-info">
                                    <span class="banner-name">Default</span>
                                    <span class="banner-cost">Free</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="banner-option" data-style="linear-gradient(135deg, #667eea 0%, #764ba2 100%)" data-cost="50">
                                <div class="banner-preview" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">Purple Blue</div>
                                <div class="banner-info">
                                    <span class="banner-name">Purple Blue</span>
                                    <span class="banner-cost">50 pts</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="banner-option" data-style="linear-gradient(135deg, #f093fb 0%, #f5576c 100%)" data-cost="75">
                                <div class="banner-preview" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">Pink Red</div>
                                <div class="banner-info">
                                    <span class="banner-name">Pink Red</span>
                                    <span class="banner-cost">75 pts</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="banner-option" data-style="linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)" data-cost="100">
                                <div class="banner-preview" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">Ocean Blue</div>
                                <div class="banner-info">
                                    <span class="banner-name">Ocean Blue</span>
                                    <span class="banner-cost">100 pts</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="banner-option" data-style="linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)" data-cost="125">
                                <div class="banner-preview" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">Green Mint</div>
                                <div class="banner-info">
                                    <span class="banner-name">Green Mint</span>
                                    <span class="banner-cost">125 pts</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="banner-option" data-style="linear-gradient(135deg, #fa709a 0%, #fee140 100%)" data-cost="150">
                                <div class="banner-preview" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">Sunset</div>
                                <div class="banner-info">
                                    <span class="banner-name">Sunset</span>
                                    <span class="banner-cost">150 pts</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Custom Title Section -->
                <div class="mb-4">
                    <h6><i class="fas fa-tag me-2"></i>Custom Title</h6>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="form-group">
                                <label for="customTitle">Custom Title (max 30 characters)</label>
                                <input type="text" class="form-control glass-input" id="customTitle" maxlength="30" placeholder="Enter your custom title">
                                <div class="form-text">Cost: 100 points</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label>Title Color</label>
                            <div class="color-options">
                                <div class="color-option" data-color="#ffffff" data-cost="0" style="background: #ffffff;" title="White - Free"></div>
                                <div class="color-option" data-color="#ffd700" data-cost="10" style="background: #ffd700;" title="Gold - 10 pts"></div>
                                <div class="color-option" data-color="#ff6b6b" data-cost="20" style="background: #ff6b6b;" title="Red - 20 pts"></div>
                                <div class="color-option" data-color="#4ecdc4" data-cost="25" style="background: #4ecdc4;" title="Teal - 25 pts"></div>
                                <div class="color-option" data-color="#45b7d1" data-cost="30" style="background: #45b7d1;" title="Blue - 30 pts"></div>
                                <div class="color-option" data-color="#96ceb4" data-cost="40" style="background: #96ceb4;" title="Green - 40 pts"></div>
                                <div class="color-option" data-color="#dda0dd" data-cost="50" style="background: #dda0dd;" title="Purple - 50 pts"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cost Summary -->
                <div class="alert alert-warning glass-alert">
                    <h6><i class="fas fa-calculator me-2"></i>Cost Summary</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <div>Banner: <span id="bannerCost">0</span> points</div>
                            <div>Custom Title: <span id="titleCost">0</span> points</div>
                            <div>Title Color: <span id="colorCost">0</span> points</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-end">
                                <strong>Total Cost: <span id="totalCost">0</span> points</strong><br>
                                <span class="text-muted">Remaining: <span id="remainingPoints">{{ rank_info.total_points }}</span> points</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary glass-button" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary glass-button" id="saveProfileBtn">Save Changes</button>
            </div>
        </div>
    </div>
</div>

<script>
// Profile customization functionality
document.addEventListener('DOMContentLoaded', function() {
    const currentPoints = {{ rank_info.total_points }};
    let selectedBanner = "{{ user_profile.banner_style if user_profile else '' }}";
    let selectedBannerCost = 0;
    let selectedTitle = "{{ user_profile.custom_title if user_profile else '' }}";
    let selectedTitleColor = "{{ user_profile.title_color if user_profile else '#ffffff' }}";
    let titleCost = selectedTitle ? 100 : 0;
    let colorCost = 0;

    // Initialize form with current values
    document.getElementById('customTitle').value = selectedTitle;
    document.getElementById('previewTitle').textContent = selectedTitle;
    document.getElementById('previewTitle').style.color = selectedTitleColor;
    
    // Set current banner as selected
    document.querySelectorAll('.banner-option').forEach(option => {
        if (option.dataset.style === selectedBanner) {
            option.classList.add('selected');
            selectedBannerCost = parseInt(option.dataset.cost);
        }
    });
    
    // Set current title color as selected
    document.querySelectorAll('.color-option').forEach(option => {
        if (option.dataset.color === selectedTitleColor) {
            option.classList.add('selected');
            colorCost = parseInt(option.dataset.cost);
        }
    });

    // Banner selection
    document.querySelectorAll('.banner-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.banner-option').forEach(o => o.classList.remove('selected'));
            this.classList.add('selected');
            selectedBanner = this.dataset.style;
            selectedBannerCost = parseInt(this.dataset.cost);
            
            // Update preview
            const previewHeader = document.getElementById('previewHeader');
            if (selectedBanner) {
                previewHeader.style.background = selectedBanner;
                previewHeader.style.backdropFilter = 'blur(20px)';
            } else {
                previewHeader.style.background = '';
                previewHeader.style.backdropFilter = '';
            }
            
            updateCosts();
        });
    });

    // Title input
    document.getElementById('customTitle').addEventListener('input', function() {
        selectedTitle = this.value;
        document.getElementById('previewTitle').textContent = selectedTitle;
        titleCost = selectedTitle ? 100 : 0;
        updateCosts();
    });

    // Color selection
    document.querySelectorAll('.color-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
            this.classList.add('selected');
            selectedTitleColor = this.dataset.color;
            colorCost = parseInt(this.dataset.cost);
            
            // Update preview
            document.getElementById('previewTitle').style.color = selectedTitleColor;
            
            updateCosts();
        });
    });

    // Update cost display
    function updateCosts() {
        const totalCost = selectedBannerCost + titleCost + colorCost;
        document.getElementById('bannerCost').textContent = selectedBannerCost;
        document.getElementById('titleCost').textContent = titleCost;
        document.getElementById('colorCost').textContent = colorCost;
        document.getElementById('totalCost').textContent = totalCost;
        document.getElementById('remainingPoints').textContent = currentPoints - totalCost;
        
        // Enable/disable save button
        const saveBtn = document.getElementById('saveProfileBtn');
        if (totalCost > currentPoints) {
            saveBtn.disabled = true;
            saveBtn.textContent = 'Not Enough Points';
        } else {
            saveBtn.disabled = false;
            saveBtn.textContent = 'Save Changes';
        }
    }

    // Save profile
    document.getElementById('saveProfileBtn').addEventListener('click', async function() {
        const totalCost = selectedBannerCost + titleCost + colorCost;
        
        if (totalCost > currentPoints) {
            alert('Not enough points!');
            return;
        }

        try {
            const response = await fetch('/save_profile', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    banner_style: selectedBanner,
                    custom_title: selectedTitle,
                    title_color: selectedTitleColor,
                    cost: totalCost
                })
            });

            const result = await response.json();
            
            if (result.success) {
                alert(result.message);
                location.reload(); // Refresh to show changes
            } else {
                alert('Error: ' + result.message);
            }
        } catch (error) {
            console.error('Error saving profile:', error);
            alert('Failed to save profile changes');
        }
    });

    // Initial cost calculation
    updateCosts();
});
</script>
{% endif %}
</div>

{% endblock %}